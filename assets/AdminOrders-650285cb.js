import{A as M,M as x}from"./modal-f6a880c0.js";import{_ as O,o as l,c as a,b as e,A,E as C,f as g,F as y,s as $,u as n,r as f,v as D,d as v}from"./index-5dc8dd2c.js";const w={props:["order"],data(){return{tempOrder:{},shipping:0}},watch:{order(){this.tempOrder=this.order,this.shipping=parseInt(this.tempOrder.total>=500?0:100)}}},E={class:"modal-dialog modal-xl"},T={class:"modal-content"},L=e("div",{class:"modal-header bg-primary text-white"},[e("h5",{class:"modal-title",id:"staticBackdropLabel"},"編輯"),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),N={class:"modal-body"},P={class:"container"},V={class:"row"},B={class:"col-5"},I={class:"card border-gray rounded-0 mb-5"},S={class:"card-body"},R=e("h5",{class:"card-title mb-5"},"訂單資料",-1),U={class:"mb-3"},H=e("label",{for:"orderId",class:"form-label"},"訂單編號",-1),z=["value"],F={class:"mb-3"},j=e("label",{for:"orderDate",class:"form-label"},"訂單日期",-1),q=["value"],Q={class:"form-check mb-3"},G={class:"form-check-label",for:"isPaid"},J={key:0,class:"text-success"},K={key:1,class:"text-danger"},W={class:"card border-gray rounded-0"},X={class:"card-body"},Y=e("h5",{class:"card-title mb-5"},"訂購人資訊",-1),Z={class:"mb-3"},ee=e("label",{for:"username",class:"form-label"},"訂購人",-1),te=["value"],se={class:"mb-3"},oe=e("label",{for:"phone",class:"form-label"},"訂購人手機",-1),de=["value"],le={class:"mb-3"},ae=e("label",{for:"address",class:"form-label"},"外送地址",-1),ne=["value"],re={class:"mb-3"},ie=e("label",{for:"email",class:"form-label"},"訂購人 Email",-1),ce=["value"],_e={class:"mb-3"},he=e("label",{for:"message",class:"form-label"},"訂單備註",-1),me=["value"],ue={class:"col-7"},pe={class:"card border-gray rounded-0 mb-5"},be={class:"card-body"},ge=e("h5",{class:"card-title mb-5"},"訂購內容",-1),fe={class:"table align-middle"},ve=e("thead",null,[e("tr",null,[e("td",{colspan:"2"},"品項"),e("td",null,"單價"),e("td",null,"數量"),e("td",{class:"text-end"},"價格")])],-1),ye=["src","alt"],$e={class:"mb-0"},Oe={class:"text-center"},ke={class:"text-end"},xe=e("td",{colspan:"4"},"小計",-1),Me={class:"text-end"},Ae=e("td",{colspan:"4"},"運費",-1),Ce={class:"text-end"},De=e("td",{colspan:"4",class:"fs-3"},"總金額",-1),we={class:"text-end fs-3"},Ee={class:"modal-footer"},Te=e("button",{type:"button",class:"btn btn-outline-primary","data-bs-dismiss":"modal"},"取消",-1);function Le(t,o,i,k,d,r){var c,_,u,h;return l(),a("div",E,[e("div",T,[L,e("div",N,[e("div",P,[e("div",V,[e("div",B,[e("div",I,[e("div",S,[R,e("form",null,[e("div",U,[H,e("input",{type:"text",class:"form-control",id:"orderId","aria-describedby":"emailHelp",value:d.tempOrder.id,readonly:""},null,8,z)]),e("div",F,[j,e("input",{type:"text",class:"form-control",id:"orderDate",value:new Date(i.order.create_at*1e3).toLocaleDateString(),readonly:""},null,8,q)]),e("div",Q,[A(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[0]||(o[0]=s=>d.tempOrder.is_paid=s),id:"isPaid"},null,512),[[C,d.tempOrder.is_paid]]),e("label",G,[g("是否付款： "),d.tempOrder.is_paid?(l(),a("span",J,"是")):(l(),a("span",K,"否"))])])])])]),e("div",W,[e("div",X,[Y,e("form",null,[e("div",Z,[ee,e("input",{type:"text",class:"form-control",id:"username",value:(c=d.tempOrder.user)==null?void 0:c.name,readonly:"","aria-describedby":"emailHelp"},null,8,te)]),e("div",se,[oe,e("input",{type:"tel",class:"form-control",id:"phone",value:(_=d.tempOrder.user)==null?void 0:_.tel,readonly:""},null,8,de)]),e("div",le,[ae,e("input",{type:"text",class:"form-control",id:"address",value:(u=d.tempOrder.user)==null?void 0:u.address,readonly:""},null,8,ne)]),e("div",re,[ie,e("input",{type:"email",class:"form-control",id:"email",value:(h=d.tempOrder.user)==null?void 0:h.email,readonly:""},null,8,ce)]),e("div",_e,[he,e("textarea",{type:"text",class:"form-control",id:"message",style:{resize:"none"},value:d.tempOrder.message,readonly:""},null,8,me)])])])])]),e("div",ue,[e("div",pe,[e("div",be,[ge,e("table",fe,[ve,e("tbody",null,[(l(!0),a(y,null,$(d.tempOrder.products,s=>(l(),a("tr",{key:s.id},[e("td",null,[e("img",{src:s.product.imageUrl,alt:s.product.title,width:"90",height:"90",class:"object-fit-cover"},null,8,ye)]),e("td",null,[e("p",$e,n(s.product.title),1)]),e("td",null,"NT$"+n(s.product.price)+" / "+n(s.product.unit),1),e("td",Oe,n(s.qty),1),e("td",ke,"NT$"+n(s.final_total),1)]))),128)),e("tr",null,[xe,e("td",Me,"NT$"+n(d.tempOrder.total),1)]),e("tr",null,[Ae,e("td",Ce,"NT$"+n(d.shipping),1)]),e("tr",null,[De,e("td",we,"NT$"+n(d.tempOrder.total+d.shipping),1)])])])])])])])])]),e("div",Ee,[Te,e("button",{type:"button",class:"btn btn-primary",onClick:o[1]||(o[1]=s=>t.$emit("confirmEdit",d.tempOrder))},"確認")])])])}const Ne=O(w,[["render",Le]]),Pe={props:["order"]},Ve={class:"modal-dialog"},Be={class:"modal-content"},Ie=e("div",{class:"modal-header bg-danger"},[e("h5",{class:"modal-title text-white",id:"staticBackdropLabel"},"刪除訂單"),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Se={class:"modal-body"},Re={class:"text-danger"},Ue={key:0},He={key:1},ze={class:"modal-footer"},Fe=e("button",{type:"button",class:"btn btn-outline-danger","data-bs-dismiss":"modal"},"取消",-1);function je(t,o,i,k,d,r){var c;return l(),a("div",Ve,[e("div",Be,[Ie,e("div",Se,[g(" 是否刪除 "),e("span",Re,[i.order.user?(l(),a("span",Ue,n((c=i.order.user)==null?void 0:c.name),1)):(l(),a("span",He,"全部"))]),g(" 訂單？（刪除後將無法恢復） ")]),e("div",ze,[Fe,i.order.user?(l(),a("button",{key:0,type:"button",class:"btn btn-danger",onClick:o[0]||(o[0]=_=>t.$emit("deleteOrder",i.order))},"確認刪除")):(l(),a("button",{key:1,type:"button",class:"btn btn-danger",onClick:o[1]||(o[1]=_=>t.$emit("deleteOrdersAll"))},"確認刪除"))])])])}const qe=O(Pe,[["render",je]]),{VITE_URL:m,VITE_PATH:b}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"gracewang",BASE_URL:"/vue3-QA/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},Qe={data(){return{orders:[],order:{},editModal:"",deleteModal:"",page:{}}},components:{OrderModal:Ne,DeleteOrderModal:qe,AdminPagination:M},methods:{checkLogin(){const t=document.cookie.replace(/(?:(?:^|.*;\s*)myToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=t,this.$http.post(`${m}/api/user/check`).then(()=>{this.getOrders()}).catch(o=>{alert(o.response.data.message),this.$router.push("/login")})},getOrders(t=1){this.$http.get(`${m}/api/${b}/admin/orders/?page=${t}`).then(o=>{this.orders=o.data.orders,this.page=o.data.pagination}).catch(o=>{alert(o.response.data.message)})},confirmEdit(){this.$http.put(`${m}/api/${b}/admin/order/${this.order.id}`,{data:this.order}).then(t=>{alert(t.data.message),this.editModal.hide(),this.getOrders()}).catch(t=>{alert(t.response.data.message)})},deleteOrder(){this.$http.delete(`${m}/api/${b}/admin/order/${this.order.id}`).then(t=>{alert(t.data.message),this.deleteModal.hide(),this.getOrders()}).catch(t=>{alert(t.response.data.message)})},deleteOrdersAll(){this.$http.delete(`${m}/api/${b}/admin/orders/all`).then(t=>{alert(t.data.message),this.deleteModal.hide(),this.getOrders()}).catch(t=>{alert(t.response.data.message)})},openModal(t,o){t==="edit"?(this.editModal.show(),this.order={...o}):t==="delete"?(this.deleteModal.show(),this.order={...o}):t==="deleteAll"&&(this.order={},this.deleteModal.show())}},mounted(){this.checkLogin(),this.getOrders(),this.editModal=new x(this.$refs.editModal),this.deleteModal=new x(this.$refs.deleteModal)}},Ge={class:"container mt-20"},Je={class:"text-end m-5"},Ke={class:"row"},We={class:"table table-hover align-middle"},Xe=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"訂單編號"),e("th",{scope:"col"},"訂單日期"),e("th",{scope:"col"},"訂購人"),e("th",{scope:"col"},"訂單品項"),e("th",{scope:"col"},"總金額"),e("th",{scope:"col"},"是否付款"),e("th",{scope:"col"},"操作")])],-1),Ye=e("br",null,null,-1),Ze={key:0,class:"text-success"},et={key:1,class:"text-danger"},tt=["onClick"],st=["onClick"],ot={class:"modal fade",ref:"editModal","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true"},dt={class:"modal fade",ref:"deleteModal","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true"};function lt(t,o,i,k,d,r){var h;const c=f("OrderModal"),_=f("DeleteOrderModal"),u=f("AdminPagination");return l(),a("div",Ge,[e("div",Je,[(h=d.orders)!=null&&h.length?(l(),a("button",{key:0,type:"button",class:"btn btn-outline-danger",onClick:o[0]||(o[0]=s=>r.openModal("deleteAll"))},"刪除全部訂單")):D("",!0)]),e("div",Ke,[e("table",We,[Xe,e("tbody",null,[(l(!0),a(y,null,$(d.orders,s=>(l(),a("tr",{key:s.id},[e("td",null,n(s.id),1),e("td",null,n(new Date(s.create_at*1e3).toLocaleDateString()),1),e("td",null,n(s.user.name),1),e("td",null,[(l(!0),a(y,null,$(s.products,p=>(l(),a("span",{key:p.product_id},[g(n(p.product.title),1),Ye]))),128))]),e("td",null,"NT$"+n(s.total+parseInt(s.total>=500?0:100)),1),e("td",null,[s.is_paid?(l(),a("span",Ze,"是")):(l(),a("span",et,"否"))]),e("td",null,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm me-1",onClick:p=>r.openModal("edit",s)},"編輯",8,tt),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:p=>r.openModal("delete",s)},"刪除",8,st)])]))),128))])]),e("div",ot,[v(c,{order:d.order,onConfirmEdit:r.confirmEdit},null,8,["order","onConfirmEdit"])],512),e("div",dt,[v(_,{order:d.order,onDeleteOrder:r.deleteOrder,onDeleteOrdersAll:r.deleteOrdersAll},null,8,["order","onDeleteOrder","onDeleteOrdersAll"])],512),v(u,{pages:d.page,onChangePage:r.getOrders},null,8,["pages","onChangePage"])])])}const rt=O(Qe,[["render",lt]]);export{rt as default};
