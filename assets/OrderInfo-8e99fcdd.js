import{_ as C,m as v,a as y,h,o as d,b as r,i as a,d as e,F as _,r as x,t as c,f as n,j as S,l as j,n as u,w as N,e as U,v as I}from"./index-ee355782.js";import{l as w}from"./loadingStore-27aa1f7b.js";import{c as V}from"./cartsStore-538ada13.js";import{T as b}from"./toast-eae7d92b.js";import{_ as L,a as A}from"./empty-cart-34a81ab2.js";const{VITE_URL:E,VITE_PATH:$}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"gracewang",BASE_URL:"/vue3-QA/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},q={data(){return{user:{name:"",email:"",tel:"",address:""},message:"",orderId:""}},methods:{onSubmit(){if(this.cartsTotal.carts.length){this.loading();const o={user:this.user,message:this.message};this.$http.post(`${E}/api/${$}/order`,{data:o}).then(t=>{b.fire({icon:"success",title:t.data.message,width:250}),this.loading(),this.getCart(),this.$refs.form.resetForm(),this.orderId=t.data.orderId,this.$router.push(`/order/checkout/${this.orderId}`)}).catch(t=>{b.fire({icon:"error",title:t.response.data.message,width:250})})}else b.fire({icon:"error",title:"目前購物車沒有任何品項，無法送出訂單。",width:250})},isPhone(o){return/^(09)[0-9]{8}$/.test(o)?!0:"需為正確的手機號碼格式"},...v(w,["loading"]),...v(V,["addToCart","getCart","removeCart","removeCartsAll","setCartQty"])},computed:{...y(V,["cartsTotal","cartsTotalNum","shipping"]),...y(w,["isLoading","loadingStatus"])},mounted(){this.getCart(),this.loading()}},D={key:0},P=j('<div class="row justify-content-center mb-10"><div class="col-3 border-bottom border-5 border-primary"><div class="d-flex flex-column align-items-center"><div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center mb-1" style="width:20px;height:20px;">1</div><p class="text-primary mb-2 fw-bold">填寫資料</p></div></div><div class="col-3 border-bottom border-5 border-gray"><div class="d-flex flex-column align-items-center"><div class="rounded-circle bg-gray text-white d-flex align-items-center justify-content-center mb-1" style="width:20px;height:20px;">2</div><p class="text-gray mb-2 fw-bold">確認付款</p></div></div><div class="col-3 border-bottom border-5 border-gray"><div class="d-flex flex-column align-items-center"><div class="rounded-circle bg-gray text-white d-flex align-items-center justify-content-center mb-1" style="width:20px;height:20px;">3</div><p class="text-gray mb-2 fw-bold">付款成功</p></div></div></div>',1),R={class:"row justify-content-center"},B={class:"col-lg-5 mb-5 mb-lg-0"},F=e("a",{href:"#/products"},[e("p",{class:"d-flex align-items-center text-dark mb-6"},[e("span",{class:"material-icons fs-6 me-2"}," arrow_back_ios_new "),n("繼續購物")])],-1),M={class:"table align-middle"},O=e("tr",{class:"border-bottom"},null,-1),Q={class:"d-flex align-items-center justify-content-between gap-5 py-4 px-0"},z={class:"d-flex align-items-center"},H=["onClick"],G=e("img",{src:A,alt:"delete"},null,-1),J=[G],K=["src"],W={class:"d-flex align-items-center justify-content-between w-75"},X={class:"d-flex flex-column"},Y={class:"mb-1"},Z={class:"mb-1"},ee={class:"mb-0 w-75"},se=["onUpdate:modelValue","onChange","disabled"],te=["value"],oe={class:"mb-0 text-end"},le={class:"d-flex justify-content-between"},ae=e("p",{class:"fs-6 mb-2"},"小計",-1),ie={class:"fs-6 mb-2 fw-bold"},ne={class:"d-flex justify-content-between"},de={class:"fs-6 mb-2"},re={key:0,class:"text-danger"},ce={key:1,class:"text-danger"},me={class:"fs-6 mb-2 fw-bold"},ue={class:"d-flex justify-content-between mb-2"},pe=e("p",{class:"fs-6 mb-2"},"總計",-1),he={class:"fs-6 mb-2 fw-bold"},_e={class:"col-lg-6"},be={class:"card border-0 bg-primary-light py-4 p-lg-5"},fe={class:"card-body"},ge=e("h2",{class:"h5 text-center mb-6"},"訂單連絡資訊",-1),ve={class:"mb-4"},ye=e("label",{for:"name",class:"form-label"},[n("姓名"),e("span",{class:"text-danger"},"*")],-1),xe={class:"mb-4"},we=e("label",{for:"phone",class:"form-label"},[n("手機"),e("span",{class:"text-danger"},"*")],-1),Ve={class:"mb-3"},ke=e("label",{for:"email",class:"form-label"},[n("信箱"),e("span",{class:"text-danger"},"*")],-1),Te=e("div",{class:"form-check mb-4"},[e("input",{class:"form-check-input",type:"checkbox",value:"",id:"subscribe",checked:""}),e("label",{class:"form-check-label",for:"subscribe"},"願意收到好蔬房的相關訊息和優惠資訊")],-1),Ce={class:"mb-4"},Se=e("label",{for:"address",class:"form-label"},[n("外送地址"),e("span",{class:"text-danger"},"*"),n("（到店自取者請填寫「自取」）")],-1),je={class:"mb-4"},Ne=e("label",{for:"message",class:"form-label"},"訂單備註",-1),Ue=e("div",{class:"mb-4"},[e("p",null,[n("註："),e("span",{class:"text-danger"},"*"),n("為必填欄位")])],-1),Ie=e("button",{type:"submit",class:"btn btn-primary w-100"},"送出訂單",-1),Le={key:1,class:"text-center"},Ae=e("img",{src:L,alt:"empty-cart",class:"mb-6"},null,-1),Ee=e("h3",{class:"mb-6"},"您的購物車目前是空的喔",-1),$e=e("a",{href:"#/products",class:"btn btn-primary fs-lg-5 px-5 py-3 px-lg-6"},"現在就去逛逛",-1),qe=[Ae,Ee,$e];function De(o,t,Pe,Re,i,f){var g;const k=h("VueLoading"),m=h("v-field"),p=h("error-message"),T=h("v-form");return d(),r(_,null,[a(k,{active:o.isLoading,"onUpdate:active":t[0]||(t[0]=s=>o.isLoading=s)},null,8,["active"]),(g=o.cartsTotal.carts)!=null&&g.length?(d(),r("div",D,[P,e("div",R,[e("section",B,[F,e("table",M,[e("tbody",null,[O,(d(!0),r(_,null,x(o.cartsTotal.carts,s=>(d(),r("tr",{key:s.id},[e("td",Q,[e("div",z,[e("a",{role:"button",class:u(["btn p-0 me-3",{disabled:o.loadingStatus===s.id}]),onClick:N(l=>o.removeCart(s.id),["prevent"]),style:{"border-color":"transparent"}},J,10,H),e("img",{src:s.product.imageUrl,class:"object-fit-cover flex-shrink-0",width:"80",height:"80",alt:"cart.product.title"},null,8,K)]),e("div",W,[e("div",X,[e("p",Y,c(s.product.title),1),e("p",Z,"NT$"+c(s.product.price)+" / "+c(s.product.unit),1),e("div",ee,[U(e("select",{"onUpdate:modelValue":l=>s.qty=l,class:"form-select form-select-sm",onChange:l=>o.setCartQty(s),disabled:o.loadingStatus===s.id},[(d(),r(_,null,x(20,l=>e("option",{key:l+1234,value:l},c(l),9,te)),64))],40,se),[[I,s.qty]])])]),e("p",oe,"NT$"+c(s.total),1)])])]))),128))])]),e("button",{type:"button",class:"btn btn-sm btn-outline-primary mb-3",onClick:t[1]||(t[1]=(...s)=>o.removeCartsAll&&o.removeCartsAll(...s))},"清空購物車"),e("div",le,[ae,e("p",ie,"NT$"+c(o.cartsTotal.total),1)]),e("div",ne,[e("p",de,[n(" 運費 "),o.cartsTotal.total<500?(d(),r("small",re,"(消費滿 $500 可享免運優惠)")):(d(),r("small",ce,"(恭禧您已達免運門檻！)"))]),e("p",me,"NT$"+c(o.shipping),1)]),e("div",ue,[pe,e("p",he,"NT$"+c(o.cartsTotal.final_total+o.shipping),1)])]),e("section",_e,[e("div",be,[e("div",fe,[a(T,{onSubmit:f.onSubmit,ref:"form"},{default:S(({errors:s})=>[ge,e("div",ve,[ye,a(m,{id:"name",name:"姓名",type:"text",class:u(["form-control",{"is-invalid":s.姓名}]),placeholder:"王小明",rules:"required",modelValue:i.user.name,"onUpdate:modelValue":t[2]||(t[2]=l=>i.user.name=l)},null,8,["class","modelValue"]),a(p,{name:"姓名",class:"invalid-feedback"})]),e("div",xe,[we,a(m,{id:"phone",name:"電話",type:"tel",class:u(["form-control",{"is-invalid":s.電話}]),placeholder:"0912345678",rules:f.isPhone,modelValue:i.user.tel,"onUpdate:modelValue":t[3]||(t[3]=l=>i.user.tel=l)},null,8,["class","rules","modelValue"]),a(p,{name:"電話",class:"invalid-feedback"})]),e("div",Ve,[ke,a(m,{id:"email",name:"email",type:"email",class:u(["form-control",{"is-invalid":s.email}]),placeholder:"name@email.com",rules:"email|required",modelValue:i.user.email,"onUpdate:modelValue":t[4]||(t[4]=l=>i.user.email=l)},null,8,["class","modelValue"]),a(p,{name:"email",class:"invalid-feedback"})]),Te,e("div",Ce,[Se,a(m,{id:"address",name:"外送地址",type:"text",class:u(["form-control",{"is-invalid":s.外送地址}]),placeholder:"自取／○○區○街○巷○號",rules:"required",modelValue:i.user.address,"onUpdate:modelValue":t[5]||(t[5]=l=>i.user.address=l)},null,8,["class","modelValue"]),a(p,{name:"外送地址",class:"invalid-feedback"})]),e("div",je,[Ne,a(m,{as:"textarea",id:"message",name:"訂單備註",class:"form-control",rows:"5",modelValue:i.message,"onUpdate:modelValue":t[6]||(t[6]=l=>i.message=l),style:{resize:"none"}},null,8,["modelValue"])]),Ue,Ie]),_:1},8,["onSubmit"])])])])])])):(d(),r("div",Le,qe))],64)}const ze=C(q,[["render",De]]);export{ze as default};
