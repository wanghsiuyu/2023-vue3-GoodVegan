import{M}from"./modal-2ef408ea.js";import{_ as C,o as i,b as c,d as e,e as r,J as h,K as x,f as $,t as m,h as b,F as v,r as D,i as f}from"./index-2634201d.js";import{A as T}from"./AdminPagination-fbca3a3f.js";import{T as p}from"./toast-e0ba1b73.js";import"./component-functions-ab8dbfb9.js";const V={props:["coupon"],data(){return{couponModal:"",tempCoupon:{},due_date:""}},methods:{},watch:{coupon(){this.tempCoupon=this.coupon;const t=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=t},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},mounted(){this.couponModal=new M(this.$refs.modal)}},A={class:"modal fade",ref:"modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},L={class:"modal-dialog modal-dialog-centered"},U={class:"modal-content"},E=e("div",{class:"modal-header bg-primary"},[e("h5",{class:"modal-title text-white",id:"exampleModalLabel"},"新增優惠券"),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),P={class:"modal-body"},N={class:"mb-3"},S=e("label",{for:"code",class:"form-label"},"優惠券名稱",-1),I={class:"mb-3"},R=e("label",{for:"code",class:"form-label"},"優惠碼",-1),B={class:"mb-3"},O=e("label",{for:"percent",class:"form-label"},"折扣百分比",-1),F={class:"mb-3"},H=e("label",{for:"date",class:"form-label"},"使用期限",-1),z={class:"mb-3 form-check"},J=e("label",{for:"is_enabled",class:"form-check-label"},"是否啟用",-1),K={class:"modal-footer"},Q=e("button",{type:"button",class:"btn btn-outline-primary","data-bs-dismiss":"modal"},"取消",-1);function j(t,o,d,g,s,a){return i(),c("div",A,[e("div",L,[e("div",U,[E,e("div",P,[e("form",null,[e("div",N,[S,r(e("input",{type:"text",class:"form-control",id:"code","onUpdate:modelValue":o[0]||(o[0]=n=>s.tempCoupon.title=n),placeholder:"請輸入優惠券名稱"},null,512),[[h,s.tempCoupon.title]])]),e("div",I,[R,r(e("input",{type:"text",class:"form-control",id:"code","onUpdate:modelValue":o[1]||(o[1]=n=>s.tempCoupon.code=n),placeholder:"請輸入優惠碼"},null,512),[[h,s.tempCoupon.code]])]),e("div",B,[O,r(e("input",{type:"number",min:"1",max:"100",class:"form-control",id:"percent","onUpdate:modelValue":o[2]||(o[2]=n=>s.tempCoupon.percent=n),placeholder:"請輸入折扣百分比（數字）"},null,512),[[h,s.tempCoupon.percent,void 0,{number:!0}]])]),e("div",F,[H,r(e("input",{type:"date",class:"form-control",id:"date","onUpdate:modelValue":o[3]||(o[3]=n=>s.due_date=n),placeholder:"請輸入使用期限"},null,512),[[h,s.due_date]])]),e("div",z,[r(e("input",{type:"checkbox",class:"form-check-input",id:"is_enabled","true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=n=>s.tempCoupon.is_enabled=n)},null,512),[[x,s.tempCoupon.is_enabled]]),J])])]),e("div",K,[Q,e("button",{type:"button",class:"btn btn-primary",onClick:o[5]||(o[5]=n=>t.$emit("updateCoupon",s.tempCoupon))},"確認")])])])],512)}const q=C(V,[["render",j]]),G={props:["coupon"],data(){return{deleteCouponModal:""}},mounted(){this.deleteCouponModal=new M(this.$refs.modal)}},W={class:"modal fade",ref:"modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},X={class:"modal-dialog modal-dialog-centered"},Y={class:"modal-content"},Z=e("div",{class:"modal-header bg-danger"},[e("h5",{class:"modal-title text-white",id:"exampleModalLabel"},"刪除優惠券"),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ee={class:"modal-body"},oe={class:"text-danger"},te={class:"modal-footer"},se=e("button",{type:"button",class:"btn btn-outline-danger","data-bs-dismiss":"modal"},"取消",-1);function ne(t,o,d,g,s,a){return i(),c("div",W,[e("div",X,[e("div",Y,[Z,e("div",ee,[$(" 確認刪除優惠券 "),e("span",oe,m(d.coupon.title),1),$(" ？（刪除後將無法恢復） ")]),e("div",te,[se,e("button",{type:"button",class:"btn btn-danger",onClick:o[0]||(o[0]=n=>t.$emit("deleteCoupon"))},"確認刪除")])])])],512)}const le=C(G,[["render",ne]]),{VITE_URL:u,VITE_PATH:_}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"gracewang",BASE_URL:"/vue3-QA/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},ae={data(){return{coupons:{},tempCoupon:{title:"",is_enabled:0,percent:100,code:""},isNew:!0,page:{}}},components:{CouponModal:q,DeleteCouponModal:le,AdminPagination:T},methods:{checkLogin(){this.$http.post(`${u}/api/user/check`).then(()=>{this.getCoupons()}).catch(t=>{p.fire({icon:"error",title:t.response.data.message,width:250}),this.$router.push("/login")})},openModal(t,o){t==="create"?(this.tempCoupon={is_enabled:0,due_date:new Date().getTime()/1e3},this.isNew=!0,this.$refs.modal.couponModal.show()):t==="edit"?(this.tempCoupon={...o},this.isNew=!1,this.$refs.modal.couponModal.show()):t==="delete"&&(this.tempCoupon={...o},this.$refs.deleteModal.deleteCouponModal.show())},updateCoupon(){let t="post",o=`${u}/api/${_}/admin/coupon`;this.isNew||(t="put",o=`${u}/api/${_}/admin/coupon/${this.tempCoupon.id}`),this.$http[t](o,{data:this.tempCoupon}).then(d=>{this.$refs.modal.couponModal.hide(),p.fire({icon:"success",title:d.data.message,width:250}),this.getCoupons()}).catch(d=>{p.fire({icon:"error",title:d.response.data.message,width:250})})},deleteCoupon(){this.$http.delete(`${u}/api/${_}/admin/coupon/${this.tempCoupon.id}`).then(t=>{this.$refs.deleteModal.deleteCouponModal.hide(),p.fire({icon:"success",title:t.data.message,width:250}),this.getCoupons()}).catch(t=>{p.fire({icon:"error",title:t.response.data.message,width:250})})},getCoupons(t=1){this.$http.get(`${u}/api/${_}/admin/coupons?page=${t}`).then(o=>{this.coupons=o.data.coupons,this.page=o.data.pagination}).catch(o=>{p.fire({icon:"error",title:o.response.data.message,width:250})})}},mounted(){const t=document.cookie.replace(/(?:(?:^|.*;\s*)myToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=t,this.checkLogin()}},de={class:"container mt-20"},ie={class:"text-end m-5"},ce={class:"row"},pe={class:"col-12"},re={class:"table table-hover"},ue=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"優惠券名稱"),e("th",{scope:"col"},"優惠碼"),e("th",{scope:"col"},"折扣百分比"),e("th",{scope:"col"},"到期日"),e("th",{scope:"col"},"是否啟用"),e("th",{scope:"col"},"操作")])],-1),me={key:0,class:"text-success"},he={key:1,class:"text-danger"},_e=["onClick"],be=["onClick"];function fe(t,o,d,g,s,a){const n=b("CouponModal"),y=b("DeleteCouponModal"),w=b("AdminPagination");return i(),c(v,null,[e("div",de,[e("div",ie,[e("button",{type:"button",class:"btn btn-primary",onClick:o[0]||(o[0]=l=>a.openModal("create"))},"新增優惠券")]),e("div",ce,[e("div",pe,[e("table",re,[ue,e("tbody",null,[(i(!0),c(v,null,D(s.coupons,l=>(i(),c("tr",{key:l.id},[e("td",null,m(l.title),1),e("td",null,m(l.code),1),e("td",null,m(l.percent)+"%",1),e("td",null,m(new Date(l.due_date*1e3).toLocaleDateString()),1),e("td",null,[l.is_enabled?(i(),c("span",me,"啟用")):(i(),c("span",he,"未啟用"))]),e("td",null,[e("button",{class:"btn btn-sm btn-outline-primary me-1",onClick:k=>a.openModal("edit",l)},"編輯",8,_e),e("button",{class:"btn btn-sm btn-outline-danger",onClick:k=>a.openModal("delete",l)},"刪除",8,be)])]))),128))])])])])]),f(n,{ref:"modal",coupon:s.tempCoupon,onUpdateCoupon:a.updateCoupon},null,8,["coupon","onUpdateCoupon"]),f(y,{ref:"deleteModal",coupon:s.tempCoupon,onDeleteCoupon:a.deleteCoupon},null,8,["coupon","onDeleteCoupon"]),f(w,{pages:s.page,onChangePage:a.getCoupons},null,8,["pages","onChangePage"])],64)}const ye=C(ae,[["render",fe]]);export{ye as default};
