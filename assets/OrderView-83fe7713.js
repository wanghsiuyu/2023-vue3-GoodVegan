import{_ as L,r as h,o as c,c as d,d as i,b as e,w as x,F as y,t as T,x as m,f as r,e as w,G as U,D as N,E,H as f,z as I,A}from"./index-55fd179e.js";const{VITE_URL:p,VITE_PATH:b}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"gracewang",BASE_URL:"/vue3-QA/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},q={data(){return{isLoading:!1,loadingStatus:"",cartsTotal:[],shipping:0,user:{name:"",email:"",tel:"",address:""},message:""}},methods:{loading(){this.isLoading=!0,setTimeout(()=>{this.isLoading=!1},500)},getCart(){this.$http.get(`${p}/api/${b}/cart`).then(t=>{this.cartsTotal=t.data.data,this.shipping=parseInt(this.cartsTotal.total>=500?0:100)}).catch(t=>{alert(t.response.data.message)})},removeCart(t){this.loadingStatus=t,this.$http.delete(`${p}/api/${b}/cart/${t}`).then(s=>{this.loadingStatus="",alert(s.data.message),this.getCart()}).catch(s=>{alert(s.response.data.message)})},removeCartsAll(){this.$http.delete(`${p}/api/${b}/carts`).then(t=>{alert(t.data.message),this.getCart()}).catch(t=>{alert(t.response.data.message)})},setCartQty(t){const s={product_id:t.product_id,qty:t.qty};this.loadingStatus=t.id,this.$http.put(`${p}/api/${b}/cart/${t.id}`,{data:s}).then(g=>{this.loadingStatus="",alert(g.data.message),this.getCart()}).catch(g=>{alert(g.response.data.message)})},onSubmit(){if(this.cartsTotal.carts.length){this.loading();const t={user:this.user,message:this.message};this.$http.post(`${p}/api/${b}/order`,{data:t}).then(s=>{alert(s.data.message),this.loading(),this.getCart(),this.$refs.form.resetForm()}).catch(s=>{alert(s.response.data.message)})}else alert("目前購物車沒有任何品項，無法送出訂單。")},isPhone(t){return/^(09)[0-9]{8}$/.test(t)?!0:"需為正確的手機號碼格式"}},mounted(){this.getCart()}},n=t=>(I("data-v-ebc6b6cb"),t=t(),A(),t),R=w('<section class="mb-5 banner" style="height:380px;" data-v-ebc6b6cb><div class="container" data-v-ebc6b6cb><div class="row justify-content-center" data-v-ebc6b6cb><div class="col-sm-9 col-md-7 col-lg-5" data-v-ebc6b6cb><h1 class="banner-plan fs-3 fs-lg-2" data-v-ebc6b6cb>訂單確認</h1></div></div></div></section>',1),D={class:"container"},P={"aria-label":"breadcrumb"},B={class:"breadcrumb mb-5"},O={class:"breadcrumb-item"},z={class:"breadcrumb-item"},F=n(()=>e("li",{class:"breadcrumb-item active","aria-current":"page"},"訂單確認",-1)),H={class:"row justify-content-center mb-20 mb-lg-8"},M={class:"col-8"},Q={class:"mb-5"},$=n(()=>e("h2",{class:"h3 text-center"},"購物車",-1)),j={key:0,class:"text-center"},G={key:1},J={class:"text-end my-4"},K={class:"table align-middle"},W=n(()=>e("tr",{class:"border-bottom"},[e("td"),e("td",null,"品項"),e("td"),e("td",null,"單價"),e("td",null,"數量"),e("td",{class:"text-center"},"價格")],-1)),X=["onClick","disabled"],Y={key:0,class:"fas fa-spinner fa-pulse"},Z={key:1,class:"material-icons fs-6 text-dark"},ee=["src"],se={class:"text-start"},te={class:"text-start"},ae=["onUpdate:modelValue","onChange","disabled"],le=["value"],oe={class:"text-end"},ne=n(()=>e("td",{colspan:"4"},"小計",-1)),ie={colspan:"2",class:"text-end"},ce={class:"border-bottom"},de={colspan:"4"},re={key:0,class:"text-danger"},me={key:1,class:"text-danger"},_e={colspan:"2",class:"text-end"},ue=n(()=>e("td",{colspan:"4",class:"fs-5"},"總計",-1)),he={colspan:"2",class:"fs-5 text-end"},pe={class:"col-6"},be={class:"mb-5"},ge=n(()=>e("h2",{class:"h3 text-center"},"訂單連絡資訊",-1)),ve={class:"mb-4"},fe=n(()=>e("label",{for:"name",class:"form-label"},[r("姓名"),e("span",{class:"text-danger"},"*")],-1)),xe={class:"mb-4"},ye=n(()=>e("label",{for:"phone",class:"form-label"},[r("手機"),e("span",{class:"text-danger"},"*")],-1)),Ve={class:"mb-3"},ke=n(()=>e("label",{for:"email",class:"form-label"},[r("信箱"),e("span",{class:"text-danger"},"*")],-1)),Te=n(()=>e("div",{class:"form-check mb-4"},[e("input",{class:"form-check-input",type:"checkbox",value:"",id:"subscribe",checked:""}),e("label",{class:"form-check-label",for:"subscribe"},"願意收到好蔬房的相關訊息和優惠資訊")],-1)),Ce={class:"mb-4"},Se=n(()=>e("label",{for:"address",class:"form-label"},[r("外送地址"),e("span",{class:"text-danger"},"*"),r("（到店自取者請填寫「自取」）")],-1)),Le={class:"mb-4"},we=n(()=>e("label",{for:"message",class:"form-label"},"訂單備註",-1)),Ue=n(()=>e("div",{class:"mb-4"},[e("p",null,[r("註："),e("span",{class:"text-danger"},"*"),r("為必填欄位")])],-1)),Ne=n(()=>e("div",{class:"text-center"},[e("button",{type:"submit",class:"btn btn-secondary btn-lg"},"送出訂單")],-1));function Ee(t,s,g,Ie,a,_){var k;const C=h("VueLoading"),V=h("RouterLink"),u=h("v-field"),v=h("error-message"),S=h("v-form");return c(),d(y,null,[i(C,{active:a.isLoading,"onUpdate:active":s[0]||(s[0]=l=>a.isLoading=l)},null,8,["active"]),R,e("section",D,[e("nav",P,[e("ol",B,[e("li",O,[i(V,{to:"/",class:"green"},{default:x(()=>[r("首頁")]),_:1})]),e("li",z,[i(V,{to:"/products",class:"green"},{default:x(()=>[r("線上訂餐")]),_:1})]),F])]),e("div",H,[e("div",M,[e("div",Q,[$,(k=a.cartsTotal.carts)!=null&&k.length?(c(),d("div",G,[e("div",J,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:s[1]||(s[1]=(...l)=>_.removeCartsAll&&_.removeCartsAll(...l))},"清空購物車")]),e("table",K,[e("tbody",null,[W,(c(!0),d(y,null,T(a.cartsTotal.carts,l=>(c(),d("tr",{key:l.id},[e("td",null,[e("a",{role:"button",class:"text-end",title:"刪除品項",onClick:U(o=>_.removeCart(l.id),["prevent"]),disabled:a.loadingStatus===l.id},[a.loadingStatus===l.id?(c(),d("i",Y)):(c(),d("span",Z," close "))],8,X)]),e("td",null,[e("img",{src:l.product.imageUrl,class:"img-cover",width:"90",height:"90",alt:"cart.product.title"},null,8,ee)]),e("td",se,m(l.product.title),1),e("td",te,"NT$"+m(l.product.price)+" / "+m(l.product.unit),1),e("td",null,[N(e("select",{"onUpdate:modelValue":o=>l.qty=o,class:"form-select",onChange:o=>_.setCartQty(l),disabled:a.loadingStatus===l.id},[(c(),d(y,null,T(20,o=>e("option",{key:o+1234,value:o},m(o),9,le)),64))],40,ae),[[E,l.qty]])]),e("td",oe,"NT$"+m(l.total),1)]))),128)),e("tr",null,[ne,e("td",ie,"NT$"+m(a.cartsTotal.total),1)]),e("tr",ce,[e("td",de,[r(" 運費 "),a.cartsTotal.total<500?(c(),d("span",re,"（消費滿 $500，即可享免運優惠！）")):(c(),d("span",me,"（恭禧您已達免運門檻！）"))]),e("td",_e,"NT$"+m(a.shipping),1)]),e("tr",null,[ue,e("td",he,"NT$"+m(a.cartsTotal.final_total+a.shipping),1)])])])])):(c(),d("h4",j,"購物車沒有任何品項"))])]),e("div",pe,[e("div",be,[i(S,{onSubmit:_.onSubmit,ref:"form"},{default:x(({errors:l})=>[ge,e("div",ve,[fe,i(u,{id:"name",name:"姓名",type:"text",class:f(["form-control",{"is-invalid":l.姓名}]),placeholder:"王小明",rules:"required",modelValue:a.user.name,"onUpdate:modelValue":s[2]||(s[2]=o=>a.user.name=o)},null,8,["class","modelValue"]),i(v,{name:"姓名",class:"invalid-feedback"})]),e("div",xe,[ye,i(u,{id:"phone",name:"電話",type:"tel",class:f(["form-control",{"is-invalid":l.電話}]),placeholder:"0912345678",rules:_.isPhone,modelValue:a.user.tel,"onUpdate:modelValue":s[3]||(s[3]=o=>a.user.tel=o)},null,8,["class","rules","modelValue"]),i(v,{name:"電話",class:"invalid-feedback"})]),e("div",Ve,[ke,i(u,{id:"email",name:"email",type:"email",class:f(["form-control",{"is-invalid":l.email}]),placeholder:"name@email.com",rules:"email|required",modelValue:a.user.email,"onUpdate:modelValue":s[4]||(s[4]=o=>a.user.email=o)},null,8,["class","modelValue"]),i(v,{name:"email",class:"invalid-feedback"})]),Te,e("div",Ce,[Se,i(u,{id:"address",name:"外送地址",type:"text",class:f(["form-control",{"is-invalid":l.外送地址}]),placeholder:"自取／○○區○街○巷○號",rules:"required",modelValue:a.user.address,"onUpdate:modelValue":s[5]||(s[5]=o=>a.user.address=o)},null,8,["class","modelValue"]),i(v,{name:"外送地址",class:"invalid-feedback"})]),e("div",Le,[we,i(u,{as:"textarea",id:"message",name:"訂單備註",class:"form-control",rows:"5",modelValue:a.message,"onUpdate:modelValue":s[6]||(s[6]=o=>a.message=o),style:{resize:"none"}},null,8,["modelValue"])]),Ue,Ne]),_:1},8,["onSubmit"])])])])])],64)}const qe=L(q,[["render",Ee],["__scopeId","data-v-ebc6b6cb"]]);export{qe as default};
