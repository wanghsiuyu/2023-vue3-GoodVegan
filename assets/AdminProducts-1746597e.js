import{A as D}from"./AdminPagination-c0636299.js";import{_ as M,i as g,o as d,b as r,d as e,j as c,k as $,t as m,g as h,K as P,f as I,F as k,r as w,n as v,L as T,e as E}from"./index-7b2cc301.js";import{M as A}from"./modal-86a7b019.js";import{T as f}from"./toast-027fd91b.js";import"./component-functions-8bcf6840.js";const{VITE_URL:N,VITE_PATH:F}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"gracewang",BASE_URL:"/2023-vue3-GoodVegan/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},R={props:["product","isNew"],data(){return{tempProduct:{}}},methods:{upload(){const l=document.cookie.replace(/(?:(?:^|.*;\s*)myToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=l;const{file:t,files:n}=this.$refs,b=t.files[0]?t.files[0]:n.files[0],o=new FormData;o.append("file-to-upload",b),this.$http.post(`${N}/api/${F}/admin/upload`,o).then(i=>{t.files[0]?(this.tempProduct.imageUrl=i.data.imageUrl,t.value=""):n.files[0]&&(this.tempProduct.imagesUrl.push(i.data.imageUrl),n.value="")}).catch(i=>{alert(i.response.data.message)})},resetForm(){this.$refs.form.resetForm()}},watch:{product(){this.tempProduct=this.product}}},S={class:"modal-dialog modal-xl"},O={class:"modal-content"},q={class:"modal-header bg-primary"},B={class:"modal-title text-white",id:"exampleModalLabel"},H=e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),z={class:"modal-body"},G={class:"container"},j={class:"row"},K={class:"col-lg-4"},J={class:"mb-4"},Q=e("label",{for:"imageUrl",class:"form-label"},"主要圖片",-1),W=["src"],X={class:"mb-10"},Y=e("label",{for:"file",class:"form-label"},"上傳圖片",-1),Z={class:"mb-2"},ee=e("label",{class:"form-label"},"新增其他圖片",-1),te={key:0},oe=["onUpdate:modelValue"],se=["src"],le={key:1},ie=e("label",{for:"files",class:"form-label"},"上傳其他圖片",-1),de={class:"col-lg-8"},re={class:"mb-3"},ae=e("label",{for:"productName",class:"form-label"},"商品名稱",-1),ce={class:"mb-3"},ne=e("label",{class:"form-label w-100"},"商品特性",-1),ue=["id","value"],me=["for"],pe={class:"row mb-3"},he={class:"col"},be=e("label",{for:"productCategory",class:"form-label w-100"},"類別",-1),_e=e("option",{value:""},"請選擇類別",-1),fe=["value"],ge={class:"col"},Pe=e("label",{for:"productUnit",class:"form-label"},"單位",-1),ve={class:"row mb-3"},ye={class:"col"},ke=e("label",{for:"productOriginPrice",class:"form-label"},"原價",-1),Ue={class:"col"},Ve=e("label",{for:"productPrice",class:"form-label"},"售價",-1),we={class:"mb-3"},Ce=e("label",{for:"productDescription",class:"form-label"},"商品介紹",-1),xe={class:"mb-3"},Me=e("label",{for:"productContent",class:"form-label"},"內容物",-1),$e={class:"mb-3"},Te=e("label",{for:"productLocation",class:"form-label"},"產地",-1),Ee={class:"mb-3 form-check"},Ae=e("label",{for:"isEnabled",class:"form-check-label"},"是否上架",-1),Le=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-primary","data-bs-dismiss":"modal"},"取消"),e("button",{type:"submit",class:"btn btn-primary"},"確認")],-1);function De(l,t,n,b,o,i){const u=g("v-field"),p=g("error-message"),C=g("v-form");return d(),r("div",S,[e("div",O,[c(C,{onSubmit:t[16]||(t[16]=a=>l.$emit("update-product",o.tempProduct)),ref:"form"},{default:$(({errors:a})=>[e("div",q,[e("h5",B,m(n.isNew?"新增":"編輯")+"商品",1),H]),e("div",z,[e("div",G,[e("div",j,[e("div",K,[e("div",J,[Q,h(e("input",{type:"text",class:"form-control mb-2",id:"imageUrl","aria-describedby":"imageUrl",placeholder:"請輸入圖片連結 或 選擇上傳圖片","onUpdate:modelValue":t[0]||(t[0]=s=>o.tempProduct.imageUrl=s)},null,512),[[P,o.tempProduct.imageUrl]]),o.tempProduct.imageUrl?(d(),r("img",{key:0,src:o.tempProduct.imageUrl,class:"img-fluid"},null,8,W)):I("",!0)]),e("div",X,[Y,e("input",{type:"file",class:"form-control",id:"file",ref:"file",onChange:t[1]||(t[1]=(...s)=>i.upload&&i.upload(...s))},null,544)]),e("div",Z,[ee,Array.isArray(o.tempProduct.imagesUrl)?(d(),r("div",te,[(d(!0),r(k,null,w(o.tempProduct.imagesUrl,(s,_)=>(d(),r(k,{key:_+1234},[h(e("input",{type:"text",class:"form-control mb-2",placeholder:"請輸入圖片連結 或 選擇上傳圖片","onUpdate:modelValue":L=>o.tempProduct.imagesUrl[_]=L},null,8,oe),[[P,o.tempProduct.imagesUrl[_]]]),e("img",{src:o.tempProduct.imagesUrl[_],alt:"",class:"img-fluid mb-2"},null,8,se)],64))),128)),!o.tempProduct.imagesUrl.length||o.tempProduct.imagesUrl[o.tempProduct.imagesUrl.length-1]?(d(),r("button",{key:0,type:"button",class:"btn btn-outline-primary w-100 mb-2",onClick:t[2]||(t[2]=s=>o.tempProduct.imagesUrl.push(""))}," 新增欄位 ")):(d(),r("button",{key:1,type:"button",class:"btn btn-outline-danger w-100",onClick:t[3]||(t[3]=s=>o.tempProduct.imagesUrl.pop())},"刪除欄位"))])):(d(),r("div",le,[e("button",{type:"button",class:"btn btn-outline-primary w-100 mb-2",onClick:t[4]||(t[4]=s=>l.$emit("createImage"))},"新增欄位")]))]),e("div",null,[ie,e("input",{type:"file",class:"form-control",id:"files",ref:"files",onChange:t[5]||(t[5]=(...s)=>i.upload&&i.upload(...s))},null,544)])]),e("div",de,[e("div",re,[ae,c(u,{type:"text",class:v(["form-control",{"is-invalid":a.商品名稱}]),id:"productName",name:"商品名稱",rules:"required","aria-describedby":"productName",placeholder:"請輸入商品名稱",modelValue:o.tempProduct.title,"onUpdate:modelValue":t[6]||(t[6]=s=>o.tempProduct.title=s)},null,8,["class","modelValue"]),c(p,{name:"商品名稱",class:"invalid-feedback"})]),e("div",ce,[ne,(d(!0),r(k,null,w(o.tempProduct.features,s=>(d(),r("div",{class:"form-check form-check-inline",key:s},[h(e("input",{class:"form-check-input",id:s,type:"checkbox",value:s,"onUpdate:modelValue":t[7]||(t[7]=_=>o.tempProduct.checkboxFeatures=_)},null,8,ue),[[T,o.tempProduct.checkboxFeatures]]),e("label",{class:"form-check-label",for:s},m(s),9,me)]))),128))]),e("div",pe,[e("div",he,[be,c(u,{as:"select",id:"productCategory",name:"類別",class:v([{"is-invalid":a.類別},"form-select"]),rules:"required",modelValue:o.tempProduct.selectCategories,"onUpdate:modelValue":t[8]||(t[8]=s=>o.tempProduct.selectCategories=s)},{default:$(()=>[_e,(d(!0),r(k,null,w(o.tempProduct.categories,s=>(d(),r("option",{key:s,value:s},m(s),9,fe))),128))]),_:2},1032,["class","modelValue"]),c(p,{name:"類別",class:"invalid-feedback"})]),e("div",ge,[Pe,c(u,{type:"text",class:v(["form-control",{"is-invalid":a.單位}]),id:"productUnit",name:"單位",rules:"required","aria-describedby":"productUnit",placeholder:"請輸入單位",modelValue:o.tempProduct.unit,"onUpdate:modelValue":t[9]||(t[9]=s=>o.tempProduct.unit=s)},null,8,["class","modelValue"]),c(p,{name:"單位",class:"invalid-feedback"})])]),e("div",ve,[e("div",ye,[ke,c(u,{type:"number",class:v(["form-control",{"is-invalid":a.原價}]),id:"productOriginPrice",name:"原價",rules:"required","aria-describedby":"productOriginPrice",placeholder:"請輸入原價",modelValue:o.tempProduct.origin_price,"onUpdate:modelValue":t[10]||(t[10]=s=>o.tempProduct.origin_price=s),modelModifiers:{number:!0}},null,8,["class","modelValue"]),c(p,{name:"原價",class:"invalid-feedback"})]),e("div",Ue,[Ve,c(u,{type:"number",class:v(["form-control",{"is-invalid":a.售價}]),id:"productPrice",name:"售價",rules:"required","aria-describedby":"productPrice",placeholder:"請輸入售價",modelValue:o.tempProduct.price,"onUpdate:modelValue":t[11]||(t[11]=s=>o.tempProduct.price=s),modelModifiers:{number:!0}},null,8,["class","modelValue"]),c(p,{name:"售價",class:"invalid-feedback"})])]),e("div",we,[Ce,h(e("textarea",{class:"form-control",id:"productDescription","aria-describedby":"productDescription",placeholder:"請輸入商品介紹","onUpdate:modelValue":t[12]||(t[12]=s=>o.tempProduct.description=s),style:{height:"100px",resize:"none"}},null,512),[[P,o.tempProduct.description]])]),e("div",xe,[Me,h(e("input",{type:"text",class:"form-control",id:"productContent","aria-describedby":"productContent",placeholder:"請輸入內容物","onUpdate:modelValue":t[13]||(t[13]=s=>o.tempProduct.content=s)},null,512),[[P,o.tempProduct.content]])]),e("div",$e,[Te,h(e("input",{type:"text",class:"form-control",id:"productLocation","aria-describedby":"productLocation",placeholder:"請輸入產地","onUpdate:modelValue":t[14]||(t[14]=s=>o.tempProduct.location=s)},null,512),[[P,o.tempProduct.location]])]),e("div",Ee,[h(e("input",{type:"checkbox",class:"form-check-input",id:"isEnabled","onUpdate:modelValue":t[15]||(t[15]=s=>o.tempProduct.is_enabled=s),value:""},null,512),[[T,o.tempProduct.is_enabled]]),Ae])])])])]),Le]),_:1},512)])])}const Ie=M(R,[["render",De]]),Ne={props:["tempProduct","deleteProduct"]},Fe={class:"modal-dialog modal-dialog-centered"},Re={class:"modal-content"},Se=e("div",{class:"modal-header bg-danger"},[e("h5",{class:"modal-title text-white",id:"exampleModalLabel"},"刪除商品"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Oe={class:"modal-body"},qe={class:"text-danger"},Be={class:"modal-footer"},He=e("button",{type:"button",class:"btn btn-outline-danger","data-bs-dismiss":"modal"},"取消",-1);function ze(l,t,n,b,o,i){return d(),r("div",Fe,[e("div",Re,[Se,e("div",Oe,[E(" 是否刪除 "),e("span",qe,m(n.tempProduct.title),1),E(" 商品？（刪除後將無法恢復） ")]),e("div",Be,[He,e("button",{type:"button",class:"btn btn-danger",onClick:t[0]||(t[0]=(...u)=>n.deleteProduct&&n.deleteProduct(...u))},"確認刪除")])])])}const Ge=M(Ne,[["render",ze]]);let U,x;const{VITE_URL:y,VITE_PATH:V}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"gracewang",BASE_URL:"/2023-vue3-GoodVegan/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},je={data(){return{products:[],tempProduct:{features:["純素","有機","無麩質","辣"],checkboxFeatures:[],categories:["超飽足果昔盆","輕食冷盤","湯品","裸食甜點","果昔飲品"],selectCategories:"",category:"1",imagesUrl:[]},isNew:!1,page:{}}},components:{AdminPagination:D,ProductModalAll:Ie,DeleteProductModal:Ge},methods:{checkLogin(){this.$http.post(`${y}/api/user/check`).then(()=>{this.getProduct()}).catch(l=>{f.fire({icon:"error",title:l.response.data.message,width:250}),this.$router.push("/login")})},getProduct(l=1){this.$http.get(`${y}/api/${V}/admin/products/?page=${l}`).then(t=>{this.products=t.data.products,this.page=t.data.pagination}).catch(t=>{f.fire({icon:"error",title:t.response.data.message,width:250})})},updateProduct(){let l=`${y}/api/${V}/admin/product`,t="post",n="新增產品成功！";this.isNew||(l=`${y}/api/${V}/admin/product/${this.tempProduct.id}`,t="put",n="編輯產品成功！"),this.$http[t](l,{data:this.tempProduct}).then(()=>{this.getProduct(),U.hide(),f.fire({icon:"success",title:n,width:250})}).catch(b=>{f.fire({icon:"error",title:b.response.data.message,width:250})})},deleteProduct(){this.$http.delete(`${y}/api/${V}/admin/product/${this.tempProduct.id}`).then(()=>{this.getProduct(),x.hide(),f.fire({icon:"success",title:"刪除產品成功！",width:250})}).catch(l=>{f.fire({icon:"error",title:l.response.data.message,width:250})})},createImage(){this.tempProduct.imagesUrl=[],this.tempProduct.imagesUrl.push("")},openModal(l,t){l==="create"?(U.show(),this.isNew=!0,this.tempProduct={features:["純素","有機","無麩質","辣"],checkboxFeatures:[],categories:["超飽足果昔盆","輕食冷盤","湯品","裸食甜點","果昔飲品"],selectCategories:"",category:"1",imagesUrl:[]}):l==="edit"?(U.show(),this.isNew=!1,this.tempProduct={...t}):l==="delete"&&(x.show(),this.tempProduct={...t})}},mounted(){const l=document.cookie.replace(/(?:(?:^|.*;\s*)myToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=l,this.checkLogin(),U=new A(this.$refs.productModal),x=new A(this.$refs.deleteModal),this.$refs.productModal.addEventListener("hidden.bs.modal",()=>{this.$refs.modal.resetForm()})}},Ke={class:"container mt-20"},Je={class:"text-end m-5"},Qe={class:"row"},We={class:"col-12"},Xe={class:"table table-hover"},Ye=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"商品 ID"),e("th",{scope:"col"},"類別"),e("th",{scope:"col"},"商品名稱"),e("th",{scope:"col"},"原價"),e("th",{scope:"col"},"售價"),e("th",{scope:"col"},"是否上架"),e("th",{scope:"col"},"操作")])],-1),Ze={scope:"row"},et={key:0,class:"text-success"},tt={key:1},ot=["onClick"],st=["onClick"],lt={class:"modal fade",ref:"productModal","data-bs-backdrop":"static",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},it={class:"modal fade",ref:"deleteModal","data-bs-backdrop":"static",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"};function dt(l,t,n,b,o,i){const u=g("ProductModalAll"),p=g("DeleteProductModal"),C=g("AdminPagination");return d(),r("div",Ke,[e("div",Je,[e("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=a=>i.openModal("create"))},"新增產品")]),e("div",Qe,[e("div",We,[e("table",Xe,[Ye,e("tbody",null,[(d(!0),r(k,null,w(o.products,a=>(d(),r("tr",{key:a.id},[e("td",Ze,m(a.id),1),e("td",null,m(a.selectCategories),1),e("td",null,m(a.title),1),e("td",null,m(l.$filters.toThousands(a.origin_price)),1),e("td",null,m(l.$filters.toThousands(a.price)),1),e("td",null,[a.is_enabled?(d(),r("span",et,"上架")):(d(),r("span",tt,"下架"))]),e("td",null,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm me-1",onClick:s=>i.openModal("edit",a)},"編輯",8,ot),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:s=>i.openModal("delete",a)},"刪除",8,st)])]))),128))])])]),e("div",lt,[c(u,{ref:"modal",product:o.tempProduct,isNew:o.isNew,onUpdateProduct:i.updateProduct,onCreateImage:i.createImage},null,8,["product","isNew","onUpdateProduct","onCreateImage"])],512),e("div",it,[c(p,{tempProduct:o.tempProduct,deleteProduct:i.deleteProduct},null,8,["tempProduct","deleteProduct"])],512),c(C,{pages:o.page,onChangePage:i.getProduct},null,8,["pages","onChangePage"])])])}const mt=M(je,[["render",dt]]);export{mt as default};
