import{_ as j,m as v,a as y,i as f,o as d,b as r,j as n,d as e,F as _,r as x,t as c,e as i,f as N,k as U,l as $,n as p,w as I,g as L,v as E}from"./index-20ebf4cd.js";import{l as w}from"./loadingStore-6e46e0b2.js";import{c as T}from"./cartsStore-70f510bf.js";import{T as h}from"./toast-0d089cd6.js";import{_ as R,a as A}from"./empty-cart-34a81ab2.js";const{VITE_URL:k,VITE_PATH:C}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"gracewang",BASE_URL:"/vue3-QA/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},q={data(){return{user:{name:"",email:"",tel:"",address:""},message:"",orderId:"",couponCode:""}},methods:{copyText(){this.couponCode="vegan888",this.getCart()},addCoupon(){const s={code:this.couponCode};this.$http.post(`${k}/api/${C}/coupon`,{data:s}).then(t=>{h.fire({icon:"success",title:t.data.message,width:250}),this.getCart()}).catch(t=>{h.fire({icon:"error",title:t.response.data.message,width:250})})},onSubmit(){if(this.cartsTotal.carts.length){this.loading();const s={user:this.user,message:this.message};this.$http.post(`${k}/api/${C}/order`,{data:s}).then(t=>{h.fire({icon:"success",title:t.data.message,width:250}),this.loading(),this.getCart(),this.$refs.form.resetForm(),this.orderId=t.data.orderId,this.$router.push(`/order/checkout/${this.orderId}`)}).catch(t=>{h.fire({icon:"error",title:t.response.data.message,width:250})})}else h.fire({icon:"error",title:"目前購物車沒有任何品項，無法送出訂單。",width:250})},isPhone(s){return/^(09)[0-9]{8}$/.test(s)?!0:"需為正確的手機號碼格式"},...v(w,["loading"]),...v(T,["addToCart","getCart","removeCart","confirmRemove","removeCartsAll","setCartQty"])},computed:{...y(T,["cartsTotal","cartsTotalNum","shipping"]),...y(w,["isLoading","loadingStatus"])},mounted(){this.getCart(),this.loading()}},D={key:0},P=$('<div class="row justify-content-center mb-10"><div class="col-3 border-bottom border-5 border-primary"><div class="d-flex flex-column align-items-center"><div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center mb-1" style="width:20px;height:20px;">1</div><p class="text-primary mb-2 fw-bold">填寫資料</p></div></div><div class="col-3 border-bottom border-5 border-gray"><div class="d-flex flex-column align-items-center"><div class="rounded-circle bg-gray text-white d-flex align-items-center justify-content-center mb-1" style="width:20px;height:20px;">2</div><p class="text-gray mb-2 fw-bold">確認付款</p></div></div><div class="col-3 border-bottom border-5 border-gray"><div class="d-flex flex-column align-items-center"><div class="rounded-circle bg-gray text-white d-flex align-items-center justify-content-center mb-1" style="width:20px;height:20px;">3</div><p class="text-gray mb-2 fw-bold">完成訂購</p></div></div></div>',1),z={class:"row justify-content-center"},B={class:"col-lg-5 mb-5 mb-lg-0"},F={class:"d-flex justify-content-between align-items-center"},M=e("a",{href:"#/products"},[e("p",{class:"d-flex align-items-center text-dark mb-6"},[e("span",{class:"material-icons fs-6 me-2"}," arrow_back_ios_new "),i("繼續購物")])],-1),O={class:"table align-middle"},Q=e("tr",{class:"border-bottom"},null,-1),H={class:"d-flex align-items-center justify-content-between gap-5 py-4 px-0"},G={class:"d-flex align-items-center"},J=["onClick"],K=e("img",{src:A,alt:"delete"},null,-1),W=[K],X=["src"],Y={class:"d-flex align-items-center justify-content-between w-75"},Z={class:"mb-1"},ee={class:"mb-1"},se={style:{width:"80px"}},te=["onUpdate:modelValue","onChange","disabled"],oe=["value"],le={class:"mb-0 text-end"},ae={class:"d-flex align-items center gap-1"},ne=e("span",{class:"material-icons"}," discount ",-1),ie=e("label",{class:"form-label"},[i("結帳輸入 "),e("span",{class:"text-primary fw-bold"},"vegan888"),i(" 即享有八八折優惠")],-1),de={class:"input-group input-group-sm mb-3"},re=["value"],ce={class:"d-flex justify-content-between"},me=e("p",{class:"fs-6 mb-2"},"小計",-1),ue={class:"fs-6 mb-2 fw-bold"},pe={class:"d-flex justify-content-between"},he={class:"fs-6 mb-2"},be={key:0,class:"text-danger"},fe={key:1,class:"text-danger"},_e={class:"fs-6 mb-2 fw-bold"},ge={class:"d-flex justify-content-between"},ve=e("p",{class:"fs-6 mb-2"},"總計",-1),ye={class:"fs-6 mb-2 fw-bold"},xe={key:0,class:"d-flex justify-content-between mb-2"},we=e("p",{class:"fs-6 mb-2 text-danger"},"折扣價",-1),Te={class:"fs-6 mb-2 fw-bold text-danger"},ke={class:"col-lg-5"},Ce={class:"card border-0 bg-primary-light py-4 p-lg-5"},Ve={class:"card-body"},Se=e("h2",{class:"h5 text-center mb-6"},"訂單連絡資訊",-1),je={class:"mb-4"},Ne=e("label",{for:"name",class:"form-label"},[i("姓名"),e("span",{class:"text-danger"},"*")],-1),Ue={class:"mb-4"},$e=e("label",{for:"phone",class:"form-label"},[i("手機"),e("span",{class:"text-danger"},"*")],-1),Ie={class:"mb-3"},Le=e("label",{for:"email",class:"form-label"},[i("信箱"),e("span",{class:"text-danger"},"*")],-1),Ee=e("div",{class:"form-check mb-4"},[e("input",{class:"form-check-input",type:"checkbox",value:"",id:"subscribe",checked:""}),e("label",{class:"form-check-label",for:"subscribe"},"願意收到好蔬房的相關訊息和優惠資訊")],-1),Re={class:"mb-4"},Ae=e("label",{for:"address",class:"form-label"},[i("外送地址"),e("span",{class:"text-danger"},"*"),i("（到店自取者請填寫「自取」）")],-1),qe={class:"mb-4"},De=e("label",{for:"message",class:"form-label"},"訂單備註",-1),Pe=e("div",{class:"mb-4"},[e("p",null,[i("註："),e("span",{class:"text-danger"},"*"),i("為必填欄位")])],-1),ze=e("button",{type:"submit",class:"btn btn-primary w-100"},"送出訂單",-1),Be={key:1,class:"text-center"},Fe=e("img",{src:R,alt:"empty-cart",class:"mb-6"},null,-1),Me=e("h3",{class:"mb-6"},"您的購物車目前是空的喔",-1),Oe=e("a",{href:"#/products",class:"btn btn-primary fs-lg-5 px-5 py-3 px-lg-6"},"現在就去逛逛",-1),Qe=[Fe,Me,Oe];function He(s,t,Ge,Je,a,m){var g;const V=f("VueLoading"),u=f("v-field"),b=f("error-message"),S=f("v-form");return d(),r(_,null,[n(V,{active:s.isLoading,"onUpdate:active":t[0]||(t[0]=o=>s.isLoading=o)},null,8,["active"]),(g=s.cartsTotal.carts)!=null&&g.length?(d(),r("div",D,[P,e("div",z,[e("section",B,[e("div",F,[M,e("button",{type:"button",class:"btn btn-sm btn-outline-gray",onClick:t[1]||(t[1]=(...o)=>s.confirmRemove&&s.confirmRemove(...o)),style:{"font-size":"12px"}},"清空購物車")]),e("table",O,[e("tbody",null,[Q,(d(!0),r(_,null,x(s.cartsTotal.carts,o=>(d(),r("tr",{key:o.id},[e("td",H,[e("div",G,[e("a",{role:"button",class:p(["btn p-0 me-3",{disabled:s.loadingStatus===o.id}]),onClick:I(l=>s.removeCart(o.id),["prevent"]),style:{"border-color":"transparent"}},W,10,J),e("img",{src:o.product.imageUrl,class:"object-fit-cover flex-shrink-0",width:"80",height:"80",alt:"cart.product.title"},null,8,X)]),e("div",Y,[e("div",null,[e("p",Z,c(o.product.title),1),e("p",ee,"NT$"+c(s.$filters.toThousands(o.product.price))+" / "+c(o.product.unit),1),e("div",se,[L(e("select",{"onUpdate:modelValue":l=>o.qty=l,class:"form-select form-select-sm",onChange:l=>s.setCartQty(o),disabled:s.loadingStatus===o.id},[(d(),r(_,null,x(20,l=>e("option",{key:l+1234,value:l},c(l),9,oe)),64))],40,te),[[E,o.qty]])])]),e("p",le,"NT$"+c(s.$filters.toThousands(o.total)),1)])])]))),128))])]),e("div",ae,[ne,ie,e("button",{type:"button",class:"btn btn-outline-gray-dark btn-sm py-0 mb-2 flex-shrink-0",style:{"font-size":"12px"},onClick:t[2]||(t[2]=(...o)=>m.copyText&&m.copyText(...o))},"複製")]),e("div",de,[e("input",{type:"text",class:"form-control",placeholder:"請輸入優惠碼","aria-label":"請輸入優惠碼",value:a.couponCode,"aria-describedby":"button-addon2"},null,8,re),e("button",{class:"btn btn-outline-primary",type:"button",id:"button-addon2",onClick:t[3]||(t[3]=(...o)=>m.addCoupon&&m.addCoupon(...o))},"套用")]),e("div",ce,[me,e("p",ue,"NT$"+c(s.$filters.toThousands(s.cartsTotal.total)),1)]),e("div",pe,[e("p",he,[i(" 運費 "),s.cartsTotal.total<500?(d(),r("small",be,"(消費滿 $500 可享免運優惠)")):(d(),r("small",fe,"(恭禧您已達免運門檻！)"))]),e("p",_e,"NT$"+c(s.shipping),1)]),e("div",ge,[ve,e("p",ye,"NT$"+c(s.$filters.toThousands(s.cartsTotal.total+s.shipping)),1)]),s.cartsTotal.total!==s.cartsTotal.final_total?(d(),r("div",xe,[we,e("p",Te,"NT$"+c(s.$filters.toThousands(s.cartsTotal.final_total+s.shipping)),1)])):N("",!0)]),e("section",ke,[e("div",Ce,[e("div",Ve,[n(S,{onSubmit:m.onSubmit,ref:"form"},{default:U(({errors:o})=>[Se,e("div",je,[Ne,n(u,{id:"name",name:"姓名",type:"text",class:p(["form-control",{"is-invalid":o.姓名}]),placeholder:"請填寫真實姓名",rules:"required",modelValue:a.user.name,"onUpdate:modelValue":t[4]||(t[4]=l=>a.user.name=l)},null,8,["class","modelValue"]),n(b,{name:"姓名",class:"invalid-feedback"})]),e("div",Ue,[$e,n(u,{id:"phone",name:"手機",type:"tel",class:p(["form-control",{"is-invalid":o.手機}]),placeholder:"0912345678",rules:m.isPhone,modelValue:a.user.tel,"onUpdate:modelValue":t[5]||(t[5]=l=>a.user.tel=l)},null,8,["class","rules","modelValue"]),n(b,{name:"手機",class:"invalid-feedback"})]),e("div",Ie,[Le,n(u,{id:"email",name:"信箱",type:"email",class:p(["form-control",{"is-invalid":o.信箱}]),placeholder:"name@email.com",rules:"email|required",modelValue:a.user.email,"onUpdate:modelValue":t[6]||(t[6]=l=>a.user.email=l)},null,8,["class","modelValue"]),n(b,{name:"信箱",class:"invalid-feedback"})]),Ee,e("div",Re,[Ae,n(u,{id:"address",name:"外送地址",type:"text",class:p(["form-control",{"is-invalid":o.外送地址}]),placeholder:"自取／○○區○街○巷○號",rules:"required",modelValue:a.user.address,"onUpdate:modelValue":t[7]||(t[7]=l=>a.user.address=l)},null,8,["class","modelValue"]),n(b,{name:"外送地址",class:"invalid-feedback"})]),e("div",qe,[De,n(u,{as:"textarea",id:"message",name:"訂單備註",class:"form-control",rows:"5",modelValue:a.message,"onUpdate:modelValue":t[8]||(t[8]=l=>a.message=l),style:{resize:"none"}},null,8,["modelValue"])]),Pe,ze]),_:1},8,["onSubmit"])])])])])])):(d(),r("div",Be,Qe))],64)}const es=j(q,[["render",He]]);export{es as default};
